# 阀门报价系统部署说明

## 项目概述

阀门报价系统是一个专为阀门销售企业设计的报价工具，能够根据客户询价表自动生成标准化的报价单。系统集成了 OCR 功能，支持图片识别和文本提取。

## 系统要求

- **操作系统**: Windows 10/11, macOS, Linux
- **Python 版本**: 3.8+
- **内存**: 建议 4GB 以上
- **存储空间**: 至少 500MB 可用空间

## 部署包内容

```
quote-system/
├── backend/                    # 后端服务
│   ├── main.py                # 主服务文件
│   ├── ocr_config.py          # OCR配置
│   ├── requirements.txt       # Python依赖
│   ├── [其他Python模块]
│   └── merchant_data/         # 用户数据目录
├── frontend/                   # 前端界面
│   ├── index.html             # 主页面
│   └── app.js                 # 前端逻辑
├── tupian/                     # OCR引擎（重要！）
│   ├── tesseract.exe          # Tesseract OCR可执行文件
│   ├── tessdata/              # OCR训练数据
│   │   ├── chi_sim.traineddata    # 中文简体
│   │   ├── eng.traineddata        # 英文
│   │   └── [其他语言数据]
│   └── [其他OCR相关文件]
└── 启动说明.md                 # 使用说明
```

## 为什么必须包含 OCR 文件？

### 1. 确保功能完整性

- **OCR 功能**: 系统支持图片识别，可以处理扫描的询价表
- **文本提取**: 自动从图片中提取文字信息
- **格式转换**: 将图片转换为可处理的 Excel 格式

### 2. 避免依赖问题

- **无需额外安装**: 其他电脑不需要单独安装 Tesseract OCR
- **版本一致性**: 确保 OCR 版本与系统兼容
- **路径配置**: 项目自动配置 OCR 路径，无需手动设置

### 3. 简化部署流程

- **一键部署**: 复制整个文件夹即可使用
- **环境独立**: 不依赖系统环境变量
- **即开即用**: 启动后 OCR 功能立即可用

## 部署步骤

### 第一步：复制项目文件

```bash
# 将整个quote-system文件夹复制到目标电脑
# 确保包含所有子目录和文件
```

### 第二步：安装 Python 依赖

```bash
# 进入后端目录
cd quote-system/backend

# 安装依赖包
pip install -r requirements.txt
```

### 第三步：启动服务

```bash
# 启动后端服务（端口8001）
cd quote-system/backend
python main.py

# 启动前端服务（端口8000）
cd quote-system/frontend
python -m http.server 8000
```

### 第四步：访问系统

- 打开浏览器访问：<http://localhost:8000>
- 默认管理员账号：
  - 用户名：admin
  - 密码：admin123

## 验证部署

### 1. 检查服务状态

```bash
# 检查后端服务
netstat -an | findstr :8001

# 检查前端服务
netstat -an | findstr :8000
```

### 2. 测试 OCR 功能

```bash
cd quote-system/backend
python ocr_config.py
```

应该看到：

```
✅ [OCR] 环境配置成功
✅ [OCR] 功能测试通过
```

### 3. 测试 API 接口

```bash
curl http://localhost:8001/
```

应该返回：`{"message": "报价系统API"}`

## 常见问题解决

### 1. OCR 功能异常

**问题**: OCR 测试失败
**解决**:

- 确认`tupian/`目录完整
- 检查`tesseract.exe`文件存在
- 验证`tessdata/`目录包含训练数据

### 2. 端口被占用

**问题**: 服务启动失败
**解决**:

- 修改`main.py`中的端口号
- 或关闭占用端口的程序

### 3. 依赖安装失败

**问题**: pip 安装错误
**解决**:

- 升级 pip: `python -m pip install --upgrade pip`
- 使用国内镜像: `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt`

## 生产环境部署建议

### 1. 使用虚拟环境

```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 使用进程管理器

```bash
# 使用PM2（Node.js进程管理器）
npm install -g pm2
pm2 start "python main.py" --name "quote-system-backend"
pm2 start "python -m http.server 8000" --name "quote-system-frontend"
```

### 3. 配置反向代理

使用 Nginx 配置反向代理，统一端口访问。

## 数据备份

### 重要数据目录

- `backend/merchant_data/`: 用户数据
- `backend/accounts.txt`: 用户账户
- `backend/merchant_data/*/default_rules.json`: 用户规则

### 备份建议

- 定期备份`merchant_data`目录
- 备份用户账户文件
- 导出重要报价单

## 技术支持

如遇到部署问题，请检查：

1. Python 版本是否符合要求
2. 所有依赖是否正确安装
3. OCR 文件是否完整
4. 端口是否被占用
5. 防火墙设置是否允许访问

---

**注意**: 请确保完整复制项目文件，特别是`tupian/`目录，这是 OCR 功能正常工作的关键！
